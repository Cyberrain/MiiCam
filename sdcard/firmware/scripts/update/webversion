#!/bin/sh
INPUT="$1"

current()
{
    ## Get version for web ui
    if [ -f /tmp/sd/firmware/www/public/static/version.json ]
    then
        WEBVERSION="$( cat /tmp/sd/firmware/www/public/static/version.json  | jq .tag | tr -d "\'"  )"
    else
        echo "ERROR: Failed to retrieve current version for web ui"
        exit 1
    fi

    echo $WEBVERSION
    exit 0
}


latest()
{
    TAG="$( curl --cacert /tmp/sd/firmware/etc/ssl/cacert.pem -s https://api.github.com/repos/miicam/miicamweb/releases/latest | jq .tag_name | tr -d "\'" )"

    if [ "x$TAG" == "x" ]
    then
        echo "Tag not found!"
        exit 1
    else
        echo "$TAG"
        exit 0
    fi
}


usage()
{
    echo "Retrieve the latest or current version tag of the web ui"
    echo "Usage: $0 [--latest|--current]"
    exit 0
}


main()
{
    if [ "$INPUT" == "--current" ]
    then
        current
    elif [ "$INPUT" == "--latest" ]
    then
        latest
    else
        usage
    fi
}

main
