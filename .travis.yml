---
env:
  global:
    - secure: BVh4wVe2YlIbIklwPXpLgVLOiBdHs2wnBQutfqaHAbfCCgz12ZaY5a/L4ALsTnxE/JGO8xcOPAPMXUXvrlbFvcE7g/X5QCLjHn/kEOiAC0IdRkok/HJJZz9qLIfyurmLyKeSjigGsBpWgE3q0OPQ1KxgDOrDT4mwZT6jjpZiYHortuTNLHat6dTM+vtlNQEaAV+fLURcaN/q78Kpuax9w9oTOQlP2tPACZFBCp/wFDSMSt27yHTAbpgPJ+qi0QXXPEt86OhV6XTAw3LpRn0G+sGFGGqf89lSpYdSRqIxVaX+ZnvMd0ztAuQvmIV5iUbjCcbl7NhVKzo+cZ0wA3WNWR5f7L4mtcFfu2swzzTliituoNjGtcQ1aNUdpNBIvknfLVZaJYOopG4ZZ4nBcz/DGjeSglTsYbV1GodlN/OScVOP/rzGNmmyWg/ELMuoJ1E3DS08KoD0+dZ/0TjvIdV4qJEMf188vVCFEKLOg6e3jZDMd7A1xX9D0pIsAAA0183zmuSZCA+LT/H/ptSDt2aIgF/ihLMr2h8n4ontxdgee5cXhPe/p44GxI95VBQrGtV79lxV7Pfnp+7sU9H+M9R+AuDUfrXgLXf1KpZCeW4sQCcIXhwxnEQLYSCNDqzSlRmjanoLV8hzewCMkhcYTPF6Vvan7ZeRG9z4j970WImKyyw=
    - secure: JK+MEd6Njq0aC7O6/EUeV658sa+/IEixFQ7aKNLuSAWkrLkI+90LbmpZQnJurWtdmtGNlIXxCcTWFkTWOV/mzKSsD0qGvVrhPh40cavsgb01DOoJ498osVCtUVdAB29Aib/4CDDoV5BRJtGTTgEjdObSt/SQZWNwSOWe/kRls72QTQpWE4Bzve5D09a1/QcLOH6SKIp3PVm7NSMuHi/Mt11ue0eyCX93rKwnRP6MCci69UYuOTsLwm7hp2sCot4Q+QyQ4ynNgdzY7fgaxZNQ0srqukj3D5QYuPVuLMjLLuW00mY1Q9d9GBGjHy6WPkCk69D2oE4mycywQgHcnpD7bCjt4e6xO8xT2C175/3K6BZpwkwqdoh6DtvrosR83cnEh6DlInbj0hTTqveRziPIuxq6CDwV/JPIyLbJzHVB4Ed2lPyBYMSi214eq1bdL68geyre4PaWeyUTGvzV5GEOvTDVBAOlb+iu+OzQqsvX4Pl7b+8QSCCZhxiGO3asZlCmepM+dAwDrNXddYblFBUYX93zGU3Y9bdPUccM1NIAKHHIV/V1twmhH45sMll5/RkfV68G5GyyI/D6/o0Mju2t+psHD1gpSQmyBFWTgzeWayKqqZ3AKT0TzWxGJSi3yXEd71VmundMYUKcfdAXamHT/aPUWcoE6c+CoAA0NrbnKp8=
    - secure: ROG6PTkeCiuSw1j/KEcekK7PMKW/JWO229ytdoEF78t9iVnq8bR0v4Iq97OiH0THNA9cWyQYsRGlyEImgVoQ8jvLN1nAgHoI42VfVGcxy5kkKdwHGx1OE0isEkLm9+50rNyF4/t2hhW9/pUQ59dsJLQ9tpdsLRXuCrvFaVO6EXYg4OFswnQdRPbOd4fW6QQHeuOtNjA3iEFlKgvHd8+Vn0ydaD5qqd+cYBfgykIphONrEwqZYbpCJFbGZA5foAVPkxWlq83Z13BkcdvBdIrx/II9Kg9dRk5nJ+99KasQAFBwVNXfl6KM0itYMny8twCY7s4TmY7lidg4QSJeWj5EEJ9yqVbL1hBiY4fAJ/hveRJxoIhj+fqopD5/F2R4lyNSGLrfTEJla1Wzxe8XYsK77NBojCitHdonXWB/DXsWSMqtkdKVuTV5tA5ZhGxOUDSwsPfqarIJk4li+b01XC6rtxy+gaxP03CtvyzTX8VDZWJCXS6LBYC7C+a4HUpN9FL0rgbJCKgdz8uIcJmPiBIABxg4AHYckFc17Ddmzid7dZN2knzLrR6fbqazO9SqaAJHa2vm87dGlhelnvMlivp6MhqkygIhHBNzOVtN1Y4cvLLw9B9sS4jXlq4llQJMVFludCCD8Ce4a/cpN/Io1NxB09AVMjH4SmqvMEv4Row2eMQ=
    - secure: CmfGM0cmAkSslYH+xnEfH2/lWOykCvx91gwH8+84yCE1x0sPF4QcaPYVsgz2GJLcPuKZxTcooWNjtgTr+9+2bxax7r985MBCIgk/Qbr0m/gBL4c6lNDKiN2kKoeLdw5v4n2gbl23w6OzuCo6KqJBRYHf9NMhsjMBJ4K0s1Q0PxNhrjKikz2gbWIKqIi5pkXqi4Opw5BI8bMuMRHf1klih90f+xmzliB8//jmSrSUf6OkSic0XLZYtQoQP3DdLXZbmD5Cw3zhHCSjuknC7lGttLAzRqhwVPMTdjI91O2MGLPDKEDysuBRD5VHcdYh3P9sDTGacmQf/vdQIDVvHQV3iXpjCRW7cppaBw4EBVBXmtrnInuqbkbcwNGgC/CyfXCjJzsIxy83IsyQfWrcutSaHa71Sf/dvbZ23ycuKlX3a2JWWBh62waplGMD3YEDcXAidXaHS4np3FTQXUCkEwIWzZB7ZnkYR29y20oMP77GkSy2MqAGHsnGUHAEweQ3P0qHbT5iJCn7F8u/e4YDWcSPENnmyyTovJ3cY9FFhepLErOBxM7xjy66GU6tODG9lR1RM4RgyKsuRZXbZTXdLs1grF0+SnVWsXu+M5byhNmuA/AMjLybyo6ioo/yRNhmWjScmx1n6lrDtPU8bj01Q3c4DfXvwM9AQBCgRBwRbIE3+EI=

sudo: required

services:
  - docker

before_install:
  - rm image.tgz || true
  - docker ps -a
  - docker pull quay.io/fliphess/chuangmi-720p-hack
  - docker build --cache-from quay.io/fliphess/chuangmi-720p-hack -t fliphess/chuangmi-720p-hack .

script:
  - docker run -i -v "$(pwd):/result" --detach=false --tty=true --dns "8.8.8.8" fliphess/chuangmi-720p-hack /bin/bash -c 'make images clean && mv /build/chuangmi-720p-hack.zip /build/chuangmi-720p-hack.tgz /result/'

notifications:
  email: false

deploy:
  provider: releases
  api_key:
    secure: Hwq2sDcKA3bB+gCsboWHg/9wZDRj0MUBaX2fs52BHDOuA+EPbde96cf+msYVeH3ttMU77qfGNbFmE2+0FGgxA+BGkFY1uQOC+UI8Nk5/aDyTHR6EXD4FCu+8tgaw1ZMHGLE1YqjaRe1DDiAB1ZcL9TZxH4FGoynzK7P1LdttaOstyD6foz7kpp0i+BZb6fIGl0ggizFCYP84TD+VkMPD1DaEVOVma3ikGNsQgWfrpBPQowp7nph+rcAgB0FXsx9XCMCaBc2691b1ntrr61Xc37MHf5BzZ2lcKaFK9RTcOuJSMtlQb3qMLAUQazACdwJBsU8p60ILFBa0z5ci5uYqUcJJTauQcWVnkCkdNSAuNvpnh7o3pB/kGNgxJ8jeNziDr/9AyrbUcNccxzIim09mdufwdtEGL8sSJJCPO5KZc1BxdATZSSyj3gNfLy1iC1O5XLHtdZoEqVWAUnfnFbWwriX6WvI36htYgh3RbBalRbVhCYV2gUZHafq5qOW0qVwh/wq8Xrlh0nRN1RcCzzXt+mBlfGvER13Mpve5Mxdhwbmp2diYBbGqevvzh2tTJmc/Q+o2Tze13w9MXshDvkbdwmSN4e9YYzdpX0hqKXSzbdHhICJB1iFF+96pV4KKM79gHfiUVd2C0W/F4EYzLQhpeQhtkf+vDt0j2JzkUZu1gaI=
  file_glob: true
  file: chuangmi-720p-hack.*
  skip_cleanup: true

on:
    tags: true
